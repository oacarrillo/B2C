<!--A Design by W3layouts
Author: W3layout
Author URL: http://w3layouts.com
License: Creative Commons Attribution 3.0 Unported
License URL: http://creativecommons.org/licenses/by/3.0/
-->
<!DOCTYPE HTML>
<head>
<title>KALLSONYS´S - CARRITO DE COMPRAS</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link href="css/style.css" rel="stylesheet" type="text/css" media="all"/>
<link href="css/login.css" rel="stylesheet" type="text/css" media="all"/>
<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script> 
<script type="text/javascript" src="js/move-top.js"></script>
<script type="text/javascript" src="js/easing.js"></script>
<script type="text/javascript" src="js/utilerias.js"></script>
<style>
	table {
	    font-family: arial, sans-serif;
	    border-collapse: collapse;
	    width: 100%;
	}

	td, th {
	    border: 1px solid #dddddd;
	    text-align: left;
	    padding: 8px;
	}

	tr:nth-child(even) {
	    background-color: #dddddd;
	}
</style>
</head>
<body>
  <div class="wrap">
	<div class="header">
		<div class="headertop_desc">
			<div class="call">
 				 <p><span>Necesita Ayuda?</span> Llamenos <span class="number">57-1-3208320</span></span></p>
			</div>
			<div class="account_desc" id="menusup">
                <p>Bienvenido, <span id="nameusuario">Por favor ingrese al sistema</span></p>
				<br>
                <ul>
                    <div id="divLogin" style="float: right;">

                    </div>
				</ul>
			</div>
			<div class="clear"></div>
		</div>
		<div class="header_top">
			<div class="logo">
				<a href="index.html"><img src="images/logo.png" alt="" /></a>
			</div>
			  <div class="cart" id="concar">
                   <p>Bienvenido a kallsony's - <span>Carrito:</span>
                       <div id="dd" class="wrapper-dropdown-2"> 

                        </div>
                    </p>
			 </div>
			<script type="text/javascript">
			
            
			//construye los productos
			function jsonProd(prod){
				var temp0="",temp1="",temp2="",temp3="",temp4="",temp5="",temp6="",temp7="",temp8="",temp9="";
	            var prods = sessionStorage.prodCar.split("|");  
	            var tam=prods.length;
	          	for (var inti=0; inti < prods.length; inti++){
          			prod = prods[inti].split(";");
					if(inti==0){temp0 = {"detOrdenProductoId":prod[3],"detOrdenValorUnitario":prod[1],"detOrdenCantidad":prod[2]};}
					if(inti==1){temp1 = {"detOrdenProductoId":prod[3],"detOrdenValorUnitario":prod[1],"detOrdenCantidad":prod[2]};}
					if(inti==2){temp2 = {"detOrdenProductoId":prod[3],"detOrdenValorUnitario":prod[1],"detOrdenCantidad":prod[2]};}
					if(inti==3){temp3 = {"detOrdenProductoId":prod[3],"detOrdenValorUnitario":prod[1],"detOrdenCantidad":prod[2]};}
					if(inti==4){temp4 = {"detOrdenProductoId":prod[3],"detOrdenValorUnitario":prod[1],"detOrdenCantidad":prod[2]};}
					if(inti==5){temp5 = {"detOrdenProductoId":prod[3],"detOrdenValorUnitario":prod[1],"detOrdenCantidad":prod[2]};}
					if(inti==6){temp6 = {"detOrdenProductoId":prod[3],"detOrdenValorUnitario":prod[1],"detOrdenCantidad":prod[2]};}
					if(inti==7){temp7 = {"detOrdenProductoId":prod[3],"detOrdenValorUnitario":prod[1],"detOrdenCantidad":prod[2]};}
					if(inti==8){temp8 = {"detOrdenProductoId":prod[3],"detOrdenValorUnitario":prod[1],"detOrdenCantidad":prod[2]};}
					if(inti==9){temp9 = {"detOrdenProductoId":prod[3],"detOrdenValorUnitario":prod[1],"detOrdenCantidad":prod[2]};}
				}						
				if(tam==0){var a=({"ordenDetalles":[temp0]});}
				if(tam==1){var a=({"ordenDetalles":[temp0,temp1]});}
				if(tam==2){var a=({"ordenDetalles":[temp0,temp1,temp2]});}
				if(tam==3){var a=({"ordenDetalles":[temp0,temp1,temp2,temp3]});}
				if(tam==4){var a=({"ordenDetalles":[temp0,temp1,temp2,temp3,temp4]});}
				if(tam==5){var a=({"ordenDetalles":[temp0,temp1,temp2,temp3,temp4,temp5]});}
				if(tam==6){var a=({"ordenDetalles":[temp0,temp1,temp2,temp3,temp4,temp5,temp6]});}
				if(tam==7){var a=({"ordenDetalles":[temp0,temp1,temp2,temp3,temp4,temp5,temp6,temp7]});}
				if(tam==8){var a=({"ordenDetalles":[temp0,temp1,temp2,temp3,temp4,temp5,temp6,temp7,temp8]});}
				if(tam==9){var a=({"ordenDetalles":[temp0,temp1,temp2,temp3,temp4,temp5,temp6,temp7,temp8,temp9]});}

				sessionStorage.datas = JSON.stringify(a);
				//console.log("datas fin:"+sessionStorage.datas);
			}

            //llama el servicio de pago
            function pagar(){
	            var prod ="";
	            var prods = sessionStorage.prodCar.split("|");
	            var tam=prods.length;
            	if(tam<=9){
            			//carga los productos
			            sessionStorage.datas="";
		            	jsonProd(prod);
						var test="calle 33";
		                var data0 = ({
			                  "token": ""+sessionStorage.tokenUser+"",
			                  "ordenCiudad": {
			                    "ciudadId": 1
			                  },
			                  "ordenPais": {
			                    "paisId": 1
			                  },
			                  "ordenDireccionEntrega": {
			                    "direccionId": 0,
			                    "direccionDescripcion": ""+test+""
			                  },
		          		});
		          		
						data0 = JSON.stringify(data0);
						data0= data0.replace("}}","},");
						sessionStorage.datas=sessionStorage.datas.replace(',""',"");
						data1 = sessionStorage.datas;
		
		                var data2 = "";
		                if(sessionStorage.tarjetaUser=="false"){

		                var client=[];
		                client[0]=document.getElementById("campo").value;
		                client[1]=document.getElementById("ano").value;
		                client[2]=document.getElementById("mes").value;
		                client[3]=document.getElementById("cod").value;
		                client[4]=document.getElementById("franquicia").value;  
		                client[5]=document.getElementById("nombretar").value;  

			                console.log(sessionStorage.tarjetaUser+" entre tarjeta");
			                data2= JSON.stringify ({
						   "tarjetaCredito":{
						      "numero":client[0],
						      "ano":client[1],
						      "mes":client[2],
						      "franquicia":client[4],
						      "nombre":client[5],
						      "codigo":client[3]
							}	                  
			                });
		                }

						console.log(data2);

						var data = (data0+data1+data2);
						data=data.replace("},{","},");
						if(data2!=""){
							data=data.replace('}{"tarjeta',',"tarjeta');
						}
						console.log("datafin"+data);  

		                var xhr = new XMLHttpRequest();
		                xhr.withCredentials = true;

		                xhr.addEventListener("readystatechange", function () {
		                  if (this.readyState === 4) {
		                    console.log(this.responseText);
                            //console.log(calcMD5(this.responseText));
                            if(calcMD5(this.responseText)=="210d15d42728f27be9cc2be9f14e7817"){
                            	alert("Su pago fue realizado exitosamente, Consulte el estado de sus productos en el menu 'Mis Ordenes'");
                            	sessionStorage.prodCar="";//Borra los articulos del carrito
                            	calculoResumenCar();
                            	window.location.assign("index.html");
                            }else{
                                alert("Su pago NO pudo ser procesado. No se desconto ningun valor de su tarjeta de credito");    
                                window.location.assign("index.html");
                            }
		                  }
		                });
		                xhr.open("POST", "http://35.184.218.7:8080/SERVICES_OMS/ordenService/ordenC");
		                xhr.setRequestHeader("content-type", "application/json");
		                xhr.setRequestHeader("cache-control", "no-cache");
		                //console.log(data);
		                xhr.send(data);  
            	}else{
            		alert("Debe ingresar menos de 10 productos");
            	}               
            }

            //elimina columna de la tabla
            $(function () {
			    $(document).on('click', '.borrar', function (event) {
			        event.preventDefault();
			        $(this).closest('tr').remove();
			    });
			});

			//Borra un producto de las lista
			function borrarProd(i){
				i=i-1;
				var prods = sessionStorage.prodCar.split("|");//separa los productos
				//alert(prods[i]);	
				//prods.splice(i,1);
				sessionStorage.prodCar="";
				for (var inti=0; inti < prods.length; inti++){
				console.log(inti+"-"+i);
					if(inti!=i){
						if(sessionStorage.prodCar==""){
							sessionStorage.prodCar=sessionStorage.prodCar+prods[inti];
						}else{
							sessionStorage.prodCar=sessionStorage.prodCar+"|"+prods[inti];
						}
					}
				}
				console.log("quedo:"+sessionStorage.prodCar);
				calculoResumenCar();
				window.location.assign("pay.html");
			}

			function DropDown(el) {
				this.dd = el;
				this.initEvents();
			}

			DropDown.prototype = {
				initEvents : function() {
					var obj = this;

					obj.dd.on('click', function(event){
						$(this).toggleClass('active');
						event.stopPropagation();
					});	
				}
			}

			$(function() {

				var dd = new DropDown( $('#dd') );

				$(document).click(function() {
					// all dropdowns
					$('.wrapper-dropdown-2').removeClass('active');
				});

			});

		</script>
	 <div class="clear"></div>
  </div>
	<div class="header_bottom">
	     	<div class="menu">
	     		<ul>
			    	<li><a href="index.html">Inicio</a></li>
			    	<li><a href="about.html">Nosotros</a></li>
			    	<li><a href="delivery.html">Envios</a></li>
			    	<li class="active"><a href="contact.html">Contacto</a></li>
			    	<div class="clear"></div>
     			</ul>
	     	</div>
	     	<div class="search_box">
	     		<form action="product.html">
	     			<input type="text" id="find" value="Buscar" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'Search';}">
                    <input type="submit" value="" onclick="buscar()">
	     		</form>
	     	</div>
	     	<div class="clear"></div>
	     </div>	     	
   </div>


 <div class="main">
    <div class="content">
    	<div class="section group">
			<div class="col span_2_of_3">
			  	
			<h2>Sus productos son:</h2>

					<div id="tablaprod">

					</div>
				<br>

				<h2>Datos de Pago:</h2><br>
				<div id="tarjeta">
				Su pago sera cargado a la tarjeta de credito registrada
				</div>
				
				<br>
				<span><input type="submit" value="Pagar" class="myButtonCar" onclick="pagar()"></span>

			</div>
			<div class="col span_1_of_3">
				

				<div class="contact_info">
	 				<h3>Resumen de Pago</h3>
	    		    	  <div id="resumen">
				    	  		
						  </div>
				</div>
      	
			</div>
		</div>		
         </div> 
    </div>
 </div>


   <div class="footer">
   	  <div class="wrap">	
	     <div class="section group">
						<div class="social-icons">
							<h4>Siguenos en</h4>
					   		  <ul>
							      <li><a href="#" target="_blank"><img src="images/facebook.png" alt="" /></a></li>
							      <li><a href="#" target="_blank"><img src="images/twitter.png" alt="" /></a></li>
							      <li><a href="#" target="_blank"><img src="images/skype.png" alt="" /> </a></li>
							      <li><a href="#" target="_blank"> <img src="images/dribbble.png" alt="" /></a></li>
							      <li><a href="#" target="_blank"> <img src="images/linkedin.png" alt="" /></a></li>
							      <div class="clear"></div>
						     </ul>
   	 					</div>
				</div>
			</div>			
        </div>
        <div class="copy_right">
				<p>Kallsony´s © Todos los derechos reservados </p>
		   </div>

        <div id="id01" class="modal">
            <div class="modal-content animate">
                <div class="imgcontainer">
                    <span onclick="document.getElementById('id01').style.display='none'" class="close" title="Close Modal">&times;</span>
                </div>
                <div class="container">
                    <label><b>Usuario</b></label>
                    <input id="loginuser" class="text1" type="text" placeholder="Ingrese el usuario" required>
                    <label><b>Password</b></label>
                    <input id="loginpass" class="text1" type="password" placeholder="Ingrese el password" required>
                    <button class="button1" onclick="login()"><b>Login</b></button>
                </div>
            </div>
        </div>

    </div>
    <script type="text/javascript">
		$(document).ready(function() {			
			$().UItoTop({ easingType: 'easeOutQuart' });
			
            //Carga de variables de entorno

            load();		



		    if(sessionStorage.prodCar){
		        var text="";
		        var prod="";
		        var prods = sessionStorage.prodCar.split("|");//separa los productos
		        text+="<table>";
		        text+="<tr>";
		        text+="<th>Producto</th>";
		        text+="<th>Valor</th>";
		        text+="<th>Cantidad</th>";
		        text+="<th>Eliminar</th>";
		        text+="</tr>";
		        for (i=0; i < prods.length; i++){        
		            prod = prods[i].split(";");
		            text+="<tr>";
		            text+="<td>"+prod[0]+"</td>";
		            text+="<td>"+number_format(prod[1])+"</td>";
		            text+="<td>"+prod[2]+"</td>";
		            text+="<td><input type='button' class='borrar' value='Eliminar' onclick='borrarProd(i)'/></td>";
		            text+="</tr>";
		        }
		        text+="</table>";
		        $("#tablaprod").html(text);
		    }

		    var text1="";
		    text1+="<br>";
		    text1+="<h2>Total de Productos:"+sessionStorage.numeroProds+"</h2>";
		    text1+="<h2>Valor Total: <font color='red'>$"+number_format(sessionStorage.valorProds)+"</font></h2>";
		    $("#resumen").html(text1);
		    


            console.log("tar:"+sessionStorage.tarjetaUser);
            //no carga div de tarjetaas porque ya tiene una registrada
            if(sessionStorage.tarjetaUser=="false"){
				var text2="";
				text2+="<table>";
                text2+="<tr><td>Nombre</td><td><input type='text' id='nombretar'></td></tr>";
				text2+="<tr><td>Numero</td><td><input type='text' id='campo'></td></tr>";
                text2+="<tr><td>Año</td><td>";
                text2+="<select id='ano'>";
                text2+="<option>2017</option>";
                text2+="<option>2018</option>";
                text2+="<option>2019</option>";
                text2+="<option>2020</option>";
                text2+="<option>2021</option>";
                text2+="<option>2022</option>";
                text2+="<option>2023</option>";
                text2+="</select>";  
                text2+="<tr><td>Mes</td><td>";
                text2+="<select id='mes'>";
                text2+="<option>1</option>";
                text2+="<option>2</option>";
                text2+="<option>3</option>";
                text2+="<option>4</option>";
                text2+="<option>5</option>";
                text2+="<option>6</option>";
                text2+="<option>7</option>";
                text2+="<option>8</option>";
                text2+="<option>9</option>";
                text2+="<option>10</option>";
                text2+="<option>11</option>";
                text2+="<option>12</option>";
                text2+="</select>";  
                text2+="<tr><td>Cod</td><td><input type='text' id='cod'></td></tr>";
                text2+="<tr><td>Franquicia</td><td>";
                text2+="<select id='franquicia'>";
                text2+="<option>VISA</option>";
                text2+="<option>MASTERCARD</option>";
                text2+="</select>";                                          
                text2+="</td></tr>";
                text2+="</table>";
				$("#tarjeta").html(text2);
            }

		});
	</script>
    <a href="#" id="toTop"><span id="toTopHover"> </span></a>
</body>
</html>

